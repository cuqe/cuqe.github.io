<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Bluesky 3L checker</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=DotGothic16&display=swap');

body {
    font-family: 'DotGothic16', monospace;
    background-color: #0f0f0f;
    color: #5865F2;
    display: flex;
    justify-content: center;
    align-items: flex-start;
    padding: 20px;
    min-height: 100vh;
    margin: 0;
}

.container {
    background-color: #1a1a1a;
    padding: 30px;
    border-radius: 12px;
    width: 100%;
    max-width: 600px;
    text-align: center;
    overflow: hidden;
}

h2 {
    margin-bottom: 20px;
}

button {
    position: relative;
    overflow: hidden;
    background-color: #5865F2;
    color: #fff;
    border: none;
    border-radius: 6px;
    padding: 10px 20px;
    font-size: 16px;
    cursor: pointer;
    margin: 6px 0;
}

button::after {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    width: 0;
    height: 0;
    background: rgba(255, 255, 255, 0.4);
    transform: translate(-50%, -50%) scale(0);
    transition: transform 0.5s ease, width 0.5s ease, height 0.5s ease;
    border-radius: 4px;
    pointer-events: none;
}

button:active::after {
    width: 200%;
    height: 200%;
    transform: translate(-50%, -50%) scale(1);
}

#counter {
    font-size: 18px;
    color: #00aaff;
    margin-top: 10px;
}

#output {
    margin-top: 20px;
    text-align: left;
    word-break: break-all;
    max-height: 400px;
    overflow-y: auto;
    background-color: #111;
    padding: 10px;
    border-radius: 8px;
}

.handle {
    display: inline-block;
    margin-bottom: 2px;
    cursor: pointer;
    color: #0af;
}
.handle:hover {
    text-decoration: underline;
}
.success { color: #00ff00; }
.failed { color: red; }
</style>
</head>
<body>
<div class="container">
<h2>Bluesky 3L checker</h2>
<button id="startBtn">チェック開始！</button>
<div id="counter">現在のチェック数: 0 / 17576</div>
<div id="output"></div>
</div>

<script>
// Reserved handles
const reservedHandles = new Set([
  'acf','add','adm','ads','afp','aji','all','alo','apc','api','app','atp','axj','bdj','bet','bin','bls','bot','bpi','brw',
  'bsm','bug','buy','cbn','cdm','cdn','cek','cgi','cgk','cgw','cid','cjw','ckd','cpb','cpi','cpj','crw','css','cxn','dev',
  'did','die','dir','dlb','doc','duk','dyt','ebu','eds','edu','end','faa','faq','fau','fbb','fir','flr','fmk','ftp','fun',
  'fxg','gbk','get','gfi','git','giu','glc','gov','gpl','grp','gue','gvg','gvs','gvz','hhu','hsi','htf','img','ioh','ios',
  'irc','irl','izz','jcc','jjx','jlo','jlp','jmd','job','jor','jpf','jpw','jtw','kak','kds','kqf','lab','lex','lgw','ljo',
  'lkm','log','lok','lwf','mac','map','mdi','mfn','mfv','mis','mlz','mms','mob','mpy','msf','msg','msn','mtd','mvz','nan',
  'nba','net','new','nfl','nil','nmg','npr','nrh','nru','ntv','nwk','oby','ois','ojh','old','opb','org','otw','otz','pay',
  'pds','pfu','pha','php','pic','pjz','plc','pnh','pop','psm','pts','pub','puf','put','puz','qin','qwy','raz','rbl','req',
  'ret','rgo','rkd','rkh','rmk','roc','rpk','rss','rus','rvz','sag','sef','sfv','sky','sms','spx','spu','sql','src','srn',
  'ssh','ssl','stv','svn','swf','sxt','syn','sys','szw','taf','tag','tbs','teb','tfq','tid','tln','tmp','tnh','top','tos',
  'tpm','trv','tux','txt','ucc','ufc','uhq','unm','uoh','upi','url','uxh','veh','ver','vid','vjo','vml','vos','vyl','web',
  'wfa','whm','win','wrl','wws','www','wyy','xfn','xju','xml','xpg','xxx','yft','yly','ymg','yml','you','yrb','yui','zdb',
  'zdn','zji','zui'
]);

const letters = 'abcdefghijklmnopqrstuvwxyz';
const handleIterator = (function*() {
    for (let i=0;i<letters.length;i++){
        for (let j=0;j<letters.length;j++){
            for (let k=0;k<letters.length;k++){
                const handle = letters[i]+letters[j]+letters[k];
                if(!reservedHandles.has(handle)) yield handle;
            }
        }
    }
})();

const output = document.getElementById('output');
const counterEl = document.getElementById('counter');
const startBtn = document.getElementById('startBtn');

let checkedCount = 0;
const totalHandles = 26*26*26 - reservedHandles.size;
const batchSize = 5; // 一度に同時チェックする数

async function checkHandle(handle) {
    const url = `https://public.api.bsky.app/xrpc/com.atproto.identity.resolveHandle?handle=${handle}.bsky.social`;
    try {
        const res = await fetch(url);
        const span = document.createElement('span');
        span.textContent = handle;
        span.className = 'handle';
        span.addEventListener('click', () => {
            navigator.clipboard.writeText(handle);
            alert(`コピーしました: ${handle}`);
        });
        if(res.status === 200){
            span.classList.add('success');
        } else {
            span.classList.add('failed');
        }
        output.appendChild(span);
        output.appendChild(document.createElement('br'));
    } catch (err) {
        const span = document.createElement('span');
        span.textContent = handle;
        span.className = 'handle failed';
        output.appendChild(span);
        output.appendChild(document.createElement('br'));
    }
}

async function runBatch() {
    const batch = [];
    for(let i=0;i<batchSize;i++){
        const next = handleIterator.next();
        if(next.done) break;
        batch.push(next.value);
    }
    if(batch.length === 0){
        console.log("✅ All handles checked.");
        return;
    }
    await Promise.all(batch.map(h=>checkHandle(h)));
    checkedCount += batch.length;
    counterEl.textContent = `現在のチェック数: ${checkedCount} / ${totalHandles}`;
    requestAnimationFrame(runBatch); // 次のバッチをすぐ実行
}

startBtn.addEventListener('click', () => {
    startBtn.disabled = true;
    runBatch();
});
</script>
</body>
</html>
